<!DOCTYPE html>
<meta charset="utf-8">
<head>
	<title>Tiversa</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<link rel="stylesheet" type="text/css" href="assets/css/landing/landingPage copy.css">
	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="assets/js/core/libraries/bootstrap.min.js"></script>
	
	<script src="assets/js/landing/data.js"></script>
	<script src="assets/js/landing/locations.js"></script>
	<script src="assets/js/landing/d3Animations.js"></script>
	<script src="assets/js/landing/localTime.js"></script>
	

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="assets/js/liveFeed/jquery.vticker-min.js"></script>

</head>

<body>
	<div id="mainDiv">	
		<div id="mapDiv"></div>
		<img id="mapDivImage" src="assets/css/landing/TiversaLogo.png" alt="Tiversa">
		<span id="localTimeSpan"></span>
		<div id="svgDiv"></div>

		<!-- <div id="chartDiv"></div> -->
		<!--<div id="svgDiv"></div>-->

		<div id="tableDiv">
			<div class="panel">
				<div class="panel-heading">
					<div>
						<ul>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">Date</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>

							</li>
						</ul>
					</div>

				</div>

				<div class="panel-body">
					<div id="tableData">
						<ul>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">1</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">2</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">3</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">4</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">5</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">5</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
							<li>
								<div class="row">
									<div class="col-xs-3 col-sm-3 col-lg-3">5</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Country</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">Infection</div>
									<div class="col-xs-3 col-sm-3 col-lg-3">File</div>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>

		</div>
 
	</div>
</body>
	
<script type="text/javascript">

	var offsetX = document.getElementById("svgDiv").offsetWidth;
	var offsetY = document.getElementById("svgDiv").offsetHeight;
	var locations = [];

	function viewPortValues() {
		offsetX = document.getElementById("svgDiv").offsetWidth;
		offsetY = document.getElementById("svgDiv").offsetHeight;

		locations = [[offsetX*0.06, offsetY*0.25, 1, "USA"], [offsetX*0.15, offsetY*0.4, 1, "USA"], [offsetX*0.2, offsetY*0.4, 1, "USA"], [offsetX*0.27, offsetY*0.4, 1, "USA"], [offsetX*0.2, offsetY*0.48, 2, "Mexico"],
					[offsetX*0.17, offsetY*0.34, 3, "Canada"], [offsetX*0.24, offsetY*0.34, 3, "Canada"], [offsetX*0.30, offsetY*0.32, 3, "Canada"],
					[offsetX*0.17, offsetY*0.34, 3, "Canada"],
					[offsetX*0.3, offsetY*0.58, 4, "Venezuela"],
					[offsetX*0.26, offsetY*0.64, 5, "Peru"],
					[offsetX*0.35, offsetY*0.64, 6, "Brazil"], [offsetX*0.32, offsetY*0.68, 6, "Brazil"],
					[offsetX*0.28, offsetY*0.78, 7, "Argentina"],
					[offsetX*0.53, offsetY*0.7, 8, "South Africa"],
					[offsetX*0.56, offsetY*0.41, 9, "Israil"],
					[offsetX*0.61, offsetY*0.41, 10, "Iran"],
					[offsetX*0.56, offsetY*0.37, 11, "Turkey"],
					[offsetX*0.52, offsetY*0.36, 12, "Romania"],
					[offsetX*0.54, offsetY*0.33, 13, "Ukraine"],
					[offsetX*0.49, offsetY*0.32, 14, "Germany"],
					[offsetX*0.46, offsetY*0.34, 15, "France"],
					[offsetX*0.44, offsetY*0.37, 16, "Spain"],
					[offsetX*0.45, offsetY*0.27, 17, "UK"],
					[offsetX*0.51, offsetY*0.22, 18, "Sweeden"],
					[offsetX*0.68, offsetY*0.47, 19, "India"],
					[offsetX*0.7, offsetY*0.39, 20, "China"], [offsetX*0.76, offsetY*0.42, 20, "China"], [offsetX*0.74, offsetY*0.35, 20, "China"],
					[offsetX*0.65, offsetY*0.27, 21, "Russia"], [offsetX*0.7, offsetY*0.3, 21, "Russia"], [offsetX*0.75, offsetY*0.28, 21, "Russia"], [offsetX*0.8, offsetY*0.3, 21, "Russia"],
					[offsetX*0.815, offsetY*0.38, 22, "South Korea"],
					[offsetX*0.85, offsetY*0.38, 23, "Japan"],
					[offsetX*0.78, offsetY*0.6, 24, "Malaysia"],
					[offsetX*0.82, offsetY*0.71, 25, "Australia"], [offsetX*0.86, offsetY*0.67, 25, "Australia"], [offsetX*0.9, offsetY*0.74, 25, "Australia"], 
					[offsetX*0.965, offsetY*0.8, 26, "New Zealand"]

					];

		setTimeout(viewPortValues, 100);
	}

	
	
	viewPortValues();
	console.log(locations[18][3]);

	var color = ["#946746","#8f9747","#4da751","#759747","#3ac9c9"];

	
	var svg = d3.select("#svgDiv")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

	function seeLocations(locations) {

		for(i=0; i<locations.length; i++) {
			var myCircle = svg.append("circle")
	                    .attr("cx",locations[i][0])
	                    .attr("cy",locations[i][1])
	                    .attr("r",5)
	                    .attr("fill", "red")
	                    .attr("opacity",1);	
	        
	        var text = svg.append("text")
	        			.attr("x", locations[i][0])
	        			.attr("y", locations[i][1])
	        			.style("fill", "white")
	        			.text(i);
		}
	}

	function circleAnimation(finalRadius, duration_sec, locationX, locationY, delay_sec, fill_color, stroke_color) {
	  	var myCircle = svg.append("circle")
	                    .attr("cx",locationX)
	                    .attr("cy",locationY)
	                    .attr("r",0)
	                    .attr("fill", fill_color)
	                    .attr("stroke", stroke_color)
	                    .attr("stroke-width",4)
	                    .attr("opacity",1);

	  		myCircle.transition()
	          .delay(delay_sec*1000)
	          .attr("r",finalRadius)
	          .duration(duration_sec*1000)
	          .attr("opacity",0)
	          .duration(duration_sec*1000)
	          .each("end",function() {
	            d3.select(this).remove();
	    });
	}

	function circleShotAnimation(startX, startY, endX, endY, randomColor, locations1) {

			


			var myCircle1 = svg.append("circle")
		                    .attr("cx",startX)
		                    .attr("cy",startY)
		                    .attr("r",4)
		                    .attr("fill",color[randomColor])
		    var myCircle2 = svg.append("circle")
		                    .attr("cx",startX)
		                    .attr("cy",startY)
		                    .attr("r",3)
		                    .attr("fill",color[randomColor])
		    var myCircle3 = svg.append("circle")
		                    .attr("cx",startX)
		                    .attr("cy",startY)
		                    .attr("r",2)
		                    .attr("fill",color[randomColor])
		    var myCircle4 = svg.append("circle")
		                    .attr("cx",startX)
		                    .attr("cy",startY)
		                    .attr("r",1)
		                    .attr("fill",color[randomColor])

		    var line = svg.append("line")
						.attr("x1", startX)
						.attr("y1", startY)
						.attr("x2", startX)
						.attr("y2", startY)
						// .attr("stroke-dasharray", 5)
						.attr("stroke", "green")
						.attr("stroke-width", 1);


		    var distance = Math.sqrt( Math.pow((startX - endX), 2) + Math.pow((startY - endY), 2) );
			var speed = 140;
			var duration = distance/speed;

			myCircle1.transition()
		    			.attr("cx", endX)
		    			.attr("cy", endY)
		    			.duration(duration*1000)
		    			.each("end", function() {
		    				
		    				//beacon animations
		    				circleAnimation(40,1.5,endX, endY,0, "none", color[randomColor]);
		    				circleAnimation(40,1.5,endX, endY,0.2, "none", color[randomColor]);
		    				circleAnimation(40,1.5,endX, endY,0.4, "none", color[randomColor]);
		  					circleAnimation(40,1.2,endX, endY,0.3, color[randomColor],"none");

		          			d3.select(this).remove();

		          			

		          			//trigger the next one
		          			if(locations1.length > 1) {
		          				for(var i=1; i<locations1.length; i++) {
							  		circleShotAnimation(locations[locations1[0]][0], locations[locations1[0]][1],
										locations[locations1[i][0]][0], locations[locations1[i][0]][1], randomColor, locations1[i]);
		  						}	
		          			}
		          			

		   				 });

		    line.transition()
					.delay(150)
				.attr("x2", endX)
				.attr("y2", endY)
				.duration(duration*1000)
				.each("end", function() {

					tempCount++;
					var staticCircle = svg.append("circle")
									.attr("cx", endX)
									.attr("cy", endY)
									.attr("r",3)
									.attr("fill", "red");

					if(tempCount == totalLocationcount) {
						console.log("equal");
						line.transition()
							.delay(2000)
							.each("end", function() {
								svg.selectAll("line").remove();
								svg.selectAll("circle").remove();
								start();
							});
						
					}
					
				});

		    

			myCircle2.transition()
						.delay(0.02*1000)
		    			.attr("cx", endX)
		    			.attr("cy", endY)
		    			.duration(duration*1000)
		    			.each("end", function() {
		          			d3.select(this).remove();
		   				 });

		    myCircle3.transition()
						.delay(0.03*1000)
		    			.attr("cx", endX)
		    			.attr("cy", endY)
		    			.duration(duration*1000)
		    			.each("end", function() {
		          			d3.select(this).remove();
		   				 });


		    myCircle4.transition()
						.delay(0.035*1000)
		    			.attr("cx", endX)
		    			.attr("cy", endY)
		    			.duration(duration*1000)
		    			.each("end", function() {
		          			d3.select(this).remove();
		   				 });

		
	}

	var locations1 = [[0],
						[[1],
							[[2],
							   [3],[6],[7]
							],
							[[4],
							   [9],[10],[12],[13]
							]
						],
						[[8],
							[22],
							[[23],
								[20],[24],
								[[29],
									[25],[26],[28],
									[[32],
										[25],[33],[34],
										[[27],
											[35],[36],[37],[38]
										]
									]
								]
							]
						]
					 ];

	var locations2 = [[18],
							[[15],
								 [25],[36]
							],
							[17],[19],[20],
							[[21],
								  [[3],
								       [8],[1],[4],[9]
								  ],
								  [7],[23]
							],
							[22],
							[[29],
								  [26],[32],[33]
							],
							[1]
					 ];

	var locations3 = [[30],
						[[22],
							[8],[3],[1],[10],[11]
						],
						[23],[16],[36],[25],[38]
					 ];
	
	var locations4 = [[26],
						[25],[36],[38],[15],[18],[22],[23],[1],[2],[3],[4],[8],[6]
					 ];

	var locations5 = [[28],
							[[26],
								 [16],[25]
							],
							[[27],
								 [36],[37]
							],
							[[19],
									[[22],
											[7],[3],[9],[11]
									],
									[15]
							]
					 ];
	var locations6 = [[3],
						 [4],[1],[8],[6],[7],[10],[11],[12],[21],[16],[36]
					 ];

	var locations7 = [[14],
						 [9],[10],[13],
						 [[3],[4],[1],[8]],
						 [[22],[23],[19],[15]],
						 [[25],[16],[29],[28],[27],[35]],
						 [34],[36]
					 ];

	var locations8 = [[14],
						 [15],[18],[20],[21],
						 [[22],
						 	  [35],[39],[2],[7]
						 ],
						 [16],[30],[26],
						 [[27],
						 	  [25],[29],[31],[32],[34]
						 ]
					 ];
	
	var locations9 = [[25],
						   [19],[20],[22],[29],[30],[31],
						   [[27],
						   		 [35],[39]
						   ]
					 ];

	var locations10 = [[27],
							[25],[26],[31],[34],[36],[37],[7],
							[[3],
								 [14],[20],[22]
							],
							[[4],
								 [13],[12],[11]
							]
					  ];

	var locationArray = [locations1, locations2, locations3, locations4, locations5, locations6,locations7,locations8,locations9, locations10];


	var tempCount = 0;
	function combineAnimation(locations1) {

			totalLocationcount = 0;
			totalCountofLocation(locations1);

			var randomColor = Math.floor((Math.random()*(color.length-1)) + 0);
			
			tempCount = 1;



			var staticCircle = svg.append("circle")
									.attr("cx", locations[locations1[0]][0])
									.attr("cy", locations[locations1[0]][1])
									.attr("r",3)
									.attr("fill", "red");

			var staticCircle1 = svg.append("circle")
									.attr("cx", locations[locations1[0]][0])
									.attr("cy", locations[locations1[0]][1])
									.attr("r",10)
									.attr("stroke", "red")
									.attr("stroke-width", 3)
									.attr("fill", "none");



			circleAnimation(40,1.5,locations[locations1[0]][0], locations[locations1[0]][1], 0, "none", color[randomColor]);
		  	circleAnimation(40,1.5,locations[locations1[0]][0], locations[locations1[0]][1], 0.2, "none", color[randomColor]);
		  	circleAnimation(40,1.5,locations[locations1[0]][0], locations[locations1[0]][1], 0.4, "none", color[randomColor]);
		  	circleAnimation(40,1.2,locations[locations1[0]][0], locations[locations1[0]][1], 0.3, color[randomColor],"none");

		  	for(var i=1; i<locations1.length; i++) {

		  		// var speed = Math.floor((Math.random()*(130)) + 110);
		  		circleShotAnimation(locations[locations1[0]][0], locations[locations1[0]][1],
					locations[locations1[i][0]][0], locations[locations1[i][0]][1], randomColor, locations1[i]);
		  	}

		 //  	circleShotAnimation(locations[locations1[0]][0], locations[locations1[0]][1],
			// 		locations[locations1[1][0]][0], locations[locations1[1][0]][1], randomColor);

			// circleShotAnimation(locations[locations1[0]][0], locations[locations1[0]][1],
			// 		locations[locations1[2][0]][0], locations[locations1[2][0]][1], randomColor);
			
			console.log("count="+totalLocationcount);	
	}

	var totalLocationcount = 0;
	function totalCountofLocation(location) {
		for(var i=0; i<location.length; i++) {
			if(location.length==1) {
				totalLocationcount++;
			} else if(location.length>1) {
				totalCountofLocation(location[i]);
			}
		}
		// console.log("count="+count);
	}

	function start() {

		 var randomLocation = Math.floor((Math.random()*(locationArray.length)) + 0);
		 console.log("location="+randomLocation);
		 combineAnimation(locationArray[randomLocation]);

		  // setTimeout(start, 4000);
	}
	
	

</script>

<script type="text/javascript">
	display_c();
	// seeLocations(locations);
	start();
</script>

<script>

	 $(function() {
             $('#tableData').vTicker('init', {
             	speed: 1000,
                 pause: 500,
                 showItems: 4,
                 padding: 5

             });
     });

</script>

</html>
